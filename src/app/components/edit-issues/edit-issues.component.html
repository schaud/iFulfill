<!-- <div
  style="
    width: 100%;
    height: 40px;
    background-color: black;
    position: sticky;
    top: 0px;
  "
> -->

<!-- <div mat-dialog-title class="flex-container">
  <button mat-button class="close-icon" [mat-dialog-close]="true">
    <mat-icon>close</mat-icon>
  </button>
</div> -->

<div style="height: 100% !important">
  <!-- </div>

<div mat-dialog-content id=" my-dialog ">
<button class="close" mat-button mat-dialog-title (click)="close()">X</button> -->
  <!-- </div>

  <input type="button" (click)="close()" value="close" />
</div>
<div class="container"> -->
  <div *ngIf="showSpinner" class="spinner-container">
    <mat-spinner color="accent"></mat-spinner>
  </div>

  <mat-accordion
    displayMode="flat"
    class="mat-table"
    name="pnlIssues"
    (click)="$event.stopPropagation()"
    (enter)="$event.stopPropagation()"
    style="height: 100% !important"
  >
    <div>
      <div id="dvFunctions">
        <button mat-raised-button color="primary">
          <mat-icon svgIcon="save_all"></mat-icon>
          <span>Save</span>
        </button>

        <button
          mat-raised-button
          color="primary"
          (click)="onNoClick(2)"
          cdkFocusInitial
        >
          <mat-icon svgIcon="save_close"></mat-icon>
          <span>Save & Close</span>
        </button>

        <!-- <button
          mat-raised-button
(click)="onNoClick()"
 [mat-dialog-close]="true"
      [mat-dialog-close]="local_data"   [mat-dialog-close]="data"
        > -->
        <mat-icon
          id="btnclose"
          svgIcon="cancel"
          style="float: right; cursor: pointer"
          color="primary"
          (click)="onNoClick(1)"
        ></mat-icon>
        <!-- <span>Cancel</span>
        </button> -->
      </div>
    </div>
    <section
      #issueSort
      matSort
      (matSortChange)="sortIssues($event, local_data)"
      class="mat-elevation-z2 mat-header-row"
      style="margin-top: 28px !important"
    >
      <span class="mat-header-cell id" mat-sort-header="id">ID#</span>
      <span class="mat-header-cell" mat-sort-header="title">Title</span>
      <span class="mat-header-cell" mat-sort-header="reported_at"
        >Reported Date</span
      >

      <span class="mat-header-cell" mat-sort-header="status">Status</span>
      <span class="mat-header-cell" mat-sort-header="criticality"
        >Criticality</span
      >
      <span class="mat-header-cell" mat-sort-header="reporter_id"
        >Reporter</span
      >
    </section>
    <ng-container style="height: 100% !important">
      <mat-expansion-panel
        #pnlIssues
        *ngFor="let issue of local_data; let i = index"
        (afterExpand)="
          selectedIssue = issue; indexExpanded = i; isNewMode = false
        "
      >
        <mat-expansion-panel-header class="expansion-container">
          <mat-panel-title class="expansion-child id">
            <mat-checkbox
              name="chkEdit"
              (click)="$event.stopPropagation()"
              (change)="selectItem($event, i)"
              [checked]="issue.checked"
            ></mat-checkbox>
            {{ issue.id }}
          </mat-panel-title>
          <mat-panel-title class="expansion-child">
            {{ issue.title }}
          </mat-panel-title>
          <mat-panel-title class="expansion-child">
            {{ issue.reported_at }}
          </mat-panel-title>

          <mat-panel-title class="expansion-child">
            <mat-form-field (click)="$event.stopPropagation()">
              <select
                matNativeControl
                name="select_status"
                [(ngModel)]="issue.status"
              >
                <option *ngFor="let c of status" [value]="c.value">
                  {{ c.title }}
                </option>
              </select>
            </mat-form-field>
          </mat-panel-title>
          <mat-panel-title class="expansion-child">
            <mat-form-field (click)="$event.stopPropagation()">
              <select
                matNativeControl
                name="select_criticality"
                [(ngModel)]="issue.criticality"
              >
                <option *ngFor="let c of criticality" [value]="c.value">
                  {{ c.title }}
                </option>
              </select>
            </mat-form-field>
          </mat-panel-title>
          <mat-panel-title class="expansion-child">
            {{ issue.reporter_id }}
          </mat-panel-title>
        </mat-expansion-panel-header>
        <div id="subdiv" style="background-color: rgba(229, 231, 231, 0.466)">
          <div
            style="
              columns: 4;
              width: 100%;
              border: 1px rgba(189, 189, 189, 0.411) solid;
            "
          >
            <div style="border-left: 1px solid rgb(218, 218, 218)">
              <label> Pending With : </label>
              <span>{{ issue.pending_with }}</span>
            </div>
            <div style="border-left: 1px solid rgb(218, 218, 218)">
              <label> Verified By :</label>
              <span>{{ issue.verified_by }}</span>
            </div>
            <div style="border-left: 1px solid rgb(218, 218, 218)">
              <label> Target Date :</label>
              <span>{{ issue.target_date }}</span>
            </div>
            <div style="border-left: 1px solid rgb(218, 218, 218)">
              <label> Closure Date :</label>
              <span>{{ issue.closure_date }}</span>
            </div>
          </div>

          <br />
          <p class="task-details">
            <label style="margin-right: 5px; vertical-align: top">
              Description :</label
            >
            <textarea
              readonly="true"
              style="display: inline; clear: left"
              cols="100"
              rows="10"
            >
 {{ issue.description }}</textarea
            >
          </p>

          <div
            style="
              background-color: rgba(231, 230, 226, 0.555);

              border: rgb(133, 130, 130, 0.322) 1px solid;
            "
          >
            <div
              style="
                display: flexbox;
                background-color: rgba(211, 220, 226, 0.842);
                height: 33px;
                vertical-align: middle;
                padding-top: 4px !important;
              "
            >
              <strong>Rmarks :</strong>
              <mat-icon
                *ngIf="isSingleRemark && !isNewMode"
                id="btnclose"
                svgIcon="add"
                title="add"
                style="
                  float: right;
                  padding: 0px !important ;
                  cursor: pointer;
                  color: rgb(6, 173, 78);
                "
                color="primary"
                (click)="showAddRemark(issue.id)"
              ></mat-icon>

              <mat-icon
                *ngIf="isSingleRemark && isNewMode"
                id="btnsaveRemark"
                svgIcon="cancel"
                title="Cancel"
                style="
                  float: right;
                  width: 30px;
                  height: 29px;
                  padding: 0px !important ;
                  cursor: pointer;
                  color: rgb(192, 12, 57);
                "
                color="primary"
                (click)="cancelAddRemark(issue.id)"
              ></mat-icon>
              <mat-icon
                *ngIf="isSingleRemark && isNewMode"
                id="btncancelRemark"
                svgIcon="save"
                title="Save"
                style="
                  float: right;
                  width: 28px;
                  height: 28px;
                  padding: 0px !important ;
                  cursor: pointer;
                  color: rgba(26, 75, 167, 0.952);
                  margin-right: 5px;
                "
                color="primary"
                (click)="showAddRemark(issue.id)"
              ></mat-icon>
            </div>

            <ul
              name="ulRemarks"
              style="padding: 0px !important ; left: 0px !important"
            >
              <div
                style="
                  display: table;
                  padding: 0px !important ;
                  left: 0px !important;
                "
                #remarklst
                name="remarklst "
                *ngFor="
                  let r of issue.remarks;
                  let i = index;
                  first as isFirst;
                  last as isLast
                "
              >
                <li
                  *ngIf="
                    isFirst && issue.expanded && isSingleRemark && isNewMode
                  "
                >
                  <form>
                    <div>
                      <img src="/assets/person-circle-outline.svg" [alt]="" />
                      <strong
                        style="
                          font-family: sans-serif;
                          font-weight: bolder;
                          color: chocolate;
                        "
                        >You</strong
                      >

                      <small
                        style="font-family: sans-serif; font-weight: bolder"
                        >{{ " on " + r.created_at }}</small
                      >

                      <textarea
                        class="remarkArea"
                        name="txtremark"
                        matInput
                        placeholder="Type your remark here .."
                      ></textarea>
                    </div>
                  </form>
                </li>
                <li>
                  <span>
                    <img src="/assets/person-circle-outline.svg" [alt]="" />
                    <strong>{{ r.user_id }}</strong>
                  </span>
                  <small>{{ " on " + r.created_at }} </small>
                  <br />
                  <samp> {{ r.remark }}</samp>
                </li>
              </div>
            </ul>
          </div>
        </div>
        <!-- <button
          style="margin-left: 25px"
          mat-raised-button
          color="primary"
          (click)="openTasksDialog()"
        >
          View Subtasks
        </button>
        <button
          style="margin-left: 25px"
          mat-raised-button
          color="primary"
          (click)="openDialog()"
        >
          Add a Subtask
        </button> -->
      </mat-expansion-panel>
    </ng-container>
  </mat-accordion>
  <p
    *ngIf="!local_data || local_data.length === 0"
    style="margin-left: auto; margin-right: auto; width: fit-content"
  >
    No issue have been Selected .
  </p>
</div>
